{"ast":null,"code":"import { MongoClient } from 'mongodb'; // /api/new-meetup\n// POST /api/new-meetup\n\nasync function handler(req, res) {\n  if (req.method === 'POST') {\n    const data = req.body;\n    const client = await MongoClient.connect('mongodb+srv://NovaAnn:kwmwBi9wmLJ0nYBw@cluster0.nn0w8.mongodb.net/myNextDatabase?retryWrites=true&w=majority');\n    const db = client.db();\n    const meetupsCollection = db.collection('meetups');\n    const result = await meetupsCollection.insertOne(data);\n    console.log(result);\n    client.close();\n    res.status(201).json({\n      message: 'Meetup inserted!'\n    });\n  } else {\n    console.log('inside api2');\n    console.log(req.query);\n    const client2 = await MongoClient.connect('mongodb+srv://NovaAnn:kwmwBi9wmLJ0nYBw@cluster0.nn0w8.mongodb.net/myNextDatabase?retryWrites=true&w=majority');\n    const db2 = client2.db();\n    const meetupsCollection2 = db2.collection('meetups');\n    console.log('Meetp collection');\n    const result2 = await meetupsCollection2.aggregate([{\n      $project: {\n        title: 1,\n        image: 1,\n        item: 1,\n        address: 1,\n        price: 1,\n        location: 1,\n        description: 1,\n        priceInt: {\n          $toInt: \"$location\"\n        }\n      }\n    }, {\n      $facet: {\n        \"categorizedByLocation\": [{\n          $sortByCount: \"$price\"\n        }],\n        \"categorizedByPrice\": [{\n          $match: {\n            price: {\n              $exists: 1\n            }\n          }\n        }, {\n          $bucket: {\n            groupBy: \"$priceInt\",\n            boundaries: [0, 20000, 40000, 60000, 80000],\n            default: \"Other\",\n            output: {\n              \"count\": {\n                $sum: 1\n              },\n              \"titles\": {\n                $push: \"$title\"\n              }\n            }\n          }\n        }]\n      }\n    }]);\n    const yourData = await result2.next();\n    console.log(yourData.categorizedByPrice);\n    console.log(yourData.categorizedByLocation);\n    client2.close();\n    res.status(201).json({\n      message: 'Meetup inserted!'\n    });\n  }\n}\n\nexport default handler;","map":null,"metadata":{},"sourceType":"module"}